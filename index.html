<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Piano Brochure Generator</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    .listing { border: 1px solid #ccc; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; }
    .listing img { max-width: 150px; display: block; margin-bottom: 0.5rem; }
    .checkbox { margin-right: 0.5rem; }
    button { margin-top: 1rem; padding: 0.5rem 1rem; }
  </style>
</head>
<body>
  <h1>Piano Brochure Generator</h1>
  <p>Select which listings you want to include in your PDF brochure:</p>

  <div id="listings"></div>

  <button onclick="generatePDF()">Generate PDF</button>

  <script>
   // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyA2932IBDCeUix6OdRaJMDIisHX0SbyDFo",
  authDomain: "pianoinv.firebaseapp.com",
  projectId: "pianoinv",
  storageBucket: "pianoinv.firebasestorage.app",
  messagingSenderId: "651707888262",
  appId: "1:651707888262:web:23131a782e31a7bb511707",
  measurementId: "G-1XQLEV28JZ"
};

    // Init Firebase + Firestore
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const listingsDiv = document.getElementById("listings");

    async function loadListings() {
      const snapshot = await db.collection("pianos").get();
      snapshot.forEach(doc => {
        const piano = doc.data();
        const div = document.createElement("div");
        div.className = "listing";
        div.innerHTML = `
          <label>
            <input type="checkbox" class="checkbox" value="${doc.id}">
            <b>${piano.brand} ${piano.model}</b><br>
            Year: ${piano.year || "N/A"}<br>
            Finish: ${piano.finish || "N/A"}<br>
            Length: ${piano.length || "N/A"}<br>
            Player: ${piano.playerSystem || "N/A"}<br>
            Price: ${piano.price || "N/A"}<br>
            ${piano.image ? `<img src="${piano.image}">` : ""}
          </label>
        `;
        listingsDiv.appendChild(div);
      });
    }

    async function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      let y = 20;

      doc.setFontSize(18);
      doc.text("Ethan Howard Piano Gallery", 20, y);
      y += 10;
      doc.setFontSize(12);
      doc.text("Available Pianos", 20, y);
      y += 10;

      document.querySelectorAll(".checkbox:checked").forEach(cb => {
        const div = cb.closest(".listing");
        const text = div.innerText.replace(/\n/g, "\n");
        y += 10;
        if (y > 270) { doc.addPage(); y = 20; }
        doc.text(text, 20, y);
        y += 40;
      });

      doc.save("piano_brochure.pdf");
    }

    loadListings();
  </script>
</body>
</html>
